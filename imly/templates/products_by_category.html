{% extends "base.html" %}

{% block title %}Imly | Food{% endblock title %}

                {% block sidebar_nav %}
                    {% load imly_tags %}

                    
                    <div class="well sidebar-nav">
                        
                        {% comment %}
                        <div class="span12">
                            <ul class="inline text-center food_chef">
                                <li><a href="#" class="food food_chef_active">Food</a></li>
                                <li><a href="{% if category %}{% url "imly_stores_by_category" category.slug %}{% else %}{% url 'imly_store_list' %}{% endif %}" class="chef food_chef_inactive">Shop</a></li>
                                <hr class="hr_less_margin">
                            </ul>
                        </div>
                        {% endcomment %}
                    
                        {% include "sidebar_nav.html" %}
                    </div> <!-- end of well sidebar-nav -->
                {% endblock sidebar_nav %}

{% block shop_or_product %}
                    
{% endblock shop_or_product %}

{% block content %}
{% load imly_tags %}
{% if object_list %}
<!-- using forloop counter to correct bootstrap bug- thumbnails dont align after first row, added bottom margin to each row fluid for proper spacing -->   
    <ul class="thumbnails">
        {% load endless %}
        
        {% paginate object_list %}
        {% for object in object_list %}
        {% if forloop.counter0|divisibleby:"3" %}<div class="row-fluid margined">{% endif %}
        <li class="span4">
            <div class="thumbnail thumbnail_custom">
                {% if request.session.place_slug %}
                                {% store_amend_geo object.store %}
                                {% if object.store.pick_up %}
                                <p class="text-left location_distance"><span class="icon-map-marker"></span> <small class="muted">

                                    {% if object.store.distance < 1 %}
                                        &lt; 1 km 
                                    {% else %}
                                        {{ object.store.distance|floatformat:"1" }} kms
                                    {% endif %}
                                {% endif %}
                                
                                
                                <span class="pull-right">
                                {% if object.store.delivers %}
                                    Delivers to you &nbsp;
                                {% else %}
                                    {% if object.store.pick_up %}
                                        Pick up required &nbsp;
                                    {% endif %}
                                {% endif %}
                                </span>
                                </small></p>
                {% endif %}
                <a href="{% url "imly_product_detail" object.store.slug object.slug %}">
                    <div class="sold_out">
                        <img src="{{ object.image_thumbnail.url }}" alt="{{ object.name }}">
                        {% if not object.items_in_stock %}
                            <img src="{{ STATIC_URL }}bootstrap/img/sold_out_tag.png" alt="sold out" class="sold_out_image">
                        {% endif %}
                        
                    </div>
                </a>
                <h5 class="less_bottom_margin"><a class="top_text" href="{% url "imly_product_detail" object.store.slug object.slug %}">{{ object.name|lower|title }}</a></h5> <p class="text-center muted lower_bottom_margin"><small class="ultra_small"><a class="sub_text" href="{{ object.store.get_absolute_url }}">{{ object.store.name|upper }}</a></small></p>
                <div class="thumbnail_info_wrapper">
                    <span class="pull-left">{{ object.currency }} {{ object.get_price.unit_price|floatformat:"0" }}<small class="muted">
                        {% if object.quantity_per_item == 1 %}
                            /{{ object.get_quantity_by_price_display }}
                        {% else %}
                            for {{ object.quantity_per_item|floatformat:"0" }} {{ object.get_quantity_by_price_display }}s
                        {% endif %} 
                    </small></span>
                    
                {% if object.store.is_open %}
                    {% if object.items_in_stock %}
                    <form method="post" action="{% url "imly_add_order" object.store.slug object.slug %}">
                        {% csrf_token %}
                        <input type="hidden" name="quantity" value="1">
                        <input type="submit" class="submit-btn btn btn-custom btn-mini pull-right" value="Order">
                    </form>
                    {% else %}
                        <small class="ultra_small muted pull-right">Fresh batch tomorrow</small>
                    {% endif %}
                {% else %}
                    <small class="ultra_small muted pull-right">Chef on vacation</small>
                {% endif %}
                    <div class="clearfix"></div>
                </div>
            </div>
        </li>
        {% if forloop.counter|divisibleby:"3" %}</div>{% endif %}
        {% if forloop.counter|divisibleby:"3" %}<div class="clearfix"></div>{% endif %}
        {% endfor %}
    </ul>
    <div class="text-center">
        {% show_pages %}
    </div>
{% else %}
    <br>
    <p class="text-center"><img src="{{ STATIC_URL }}bootstrap/img/chef_sad.png"></p><br>

    <h3 class="muted text-center">Oops, we don't have any food<br> matching your search criteria yet. Help us! </h3><p class="text-center"><a class="give_us_a_tip give_us_a_tip2" href="javascript:void(0)" data-toggle="modal">Suggest a Chef</a></p>
{% endif %}
{% endblock content %}

{% block extra_javascript %}
<script type="text/javascript">
$(document).ready(function(){
    $('form').submit(function(){
        $.ajax({
            data:$(this).serialize(),
            type:$(this).attr('method'),
            url:$(this).attr('action'),
            success:function(response){
                //alert(response['product'])

                $('#items-count_cart').html(response['count']);

                $('#items-count').html(response['count']);

                $('.dropDowncart').empty();
                $('.dropDowncart').append('<li><img class="dropDowncart_img" src="' + response['image'] + '" width="70"></li>');
                $('.dropDowncart').append('<li><ul class="dropDowncart2 unstyled">');
                $('.dropDowncart2').append('<li class="dropDowncart_product">' + response['quantity'] + ' &times; ' + '<span class="dropDowncart_product_name">' + response['product'] + '</span>' + '</li>');
                $('.dropDowncart2').append('<li class="dropDowncart_store">' + response['store'] + '</li>');
                $('.dropDowncart').append('</ul></li>');
                $('.dropdown_div').slideDown(500).delay(3000).slideUp(500);
            }
        });
        return false;
    });
});
</script>   
{% endblock extra_javascript %}