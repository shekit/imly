{% extends "base_store_product.html" %}

{% block title %}{{ object.store.name }} | {{ object.name }}{% endblock title %}

{% block shop_info %}
    <div class="well shop_info">
        
        <h4><a class="top_text" href="{% url "imly_store_detail" object.store.slug %}">{{ object.store.name }}</a></h4>
        
        <div class="expandable">
            {{ object.store.description_html|safe }}
        </div>

        <div class="row-fluid">
            <div class="span10 offset1">
                <hr>
            </div>
        </div>
        <ul class="unstyled">
            {% if object.store.provide_delivery and object.store.pick_up %}
                <li><span class="delivery_area_info">Deliver to:</span>
                {% for area in object.store.delivery_areas.all %}
                    {{ area }}{% if not forloop.last %}, {% endif %}
                {% endfor %}</li>
                <br>
                <li><span class="delivery_area_info">Pick up from:</span> {{ object.store.pick_up_location }}</li>
            {% else %}
            
            {% if object.store.provide_delivery %}
                <li><span class="delivery_area_info">Deliver to:</span>
                {% for area in object.store.delivery_areas.all %}
                    {{ area }}
                {% endfor %}</li>
            {% endif %}
            {% if object.store.pick_up %}
                <li><span class="delivery_area_info">Pick up from:</span> {{ object.store.pick_up_location }}</li>
            {% endif %}
            {% endif %}
        </ul>
        <div class="row-fluid">
            <div class="span10 offset1">
                <hr>
            </div>
        </div>
        <h5>I also make:</h5>
        
        <div class="row-fluid">
            <ul class="thumbnails">
            {% for product in object.store.product_set.all %}
            {% if forloop.counter0|divisibleby:"3" %}<div class="row-fluid margined_product_detail_aside">{% endif %}
            <li class="span4">
                <div class="thumbnail">
                    <a href="{% url "imly_product_detail" object.store.slug product.slug %}"><img src="{{ product.image_thumbnail_mini.url }}" alt="{{ product.name }}" class="centered"></a>

                    <div class="clearfix"></div>
                </div>
            </li>
            {% if forloop.counter|divisibleby:"3" %}</div>{% endif %}
            {% if forloop.counter|divisibleby:"3" %}<div class="clearfix"></div>{% endif %}
            {% endfor %}
            </ul>
        </div>
        
        <h5>Total Items in my Shop: <span class="h5_inline">{{ object.store.product_set.count }}</span></h5>
             
        <div class="row-fluid">
            <div class="span10 offset1">
                <hr>
            </div>
        </div>
        
    </div>            
{% endblock shop_info %}

{% block shop_product_content %}
    <div class="row-fluid">
        <div class="span8">
            <div class="sold_out">
                        <img class="img-rounded img-polaroid" src="{{ object.image_thumbnail_large.url }}" alt="{{ object.name }}">
                        {% if not object.items_in_stock %}
                            <img src="{{ STATIC_URL }}bootstrap/img/sold_out_tag.png" alt="sold out" class="sold_out_image_product_detail">
                        {% endif %}
                        
                    </div>
                
        </div>
        
        <div class="span4">
            <h2>{{ object.name }}</h2><small>by <a class="sub_text" href="{% url "imly_store_detail" object.store.slug %}">{{ object.store.name }}</a></small>
            <br><br>
            {% if object.quantity_per_item == 1 %}
                <h4>{{ object.currency }} {{ object.get_price.unit_price|floatformat:"0" }}<small> per {{ object.get_quantity_by_price_display }}</small></h4>
            {% else %}
                <h4>{{ object.currency }} {{ object.get_price.unit_price|floatformat:"0" }}<small> for {{object.quantity_per_item}} {{ object.get_quantity_by_price_display }}s</small></h4>
            {% endif %}
            
            {% if object.items_in_stock %}
                {% if messages %}
                    <ul class="messages unstyled">
                        {% for message in messages %}
                            {% if "error" in message.tags %}
                                <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</li>
                            {% endif %}
                        {% endfor %}
                    </ul>
                {% endif %}
            <form method="post" action="{% url "imly_add_order" object.slug %}">
            {% csrf_token %}
                {{ form.as_p }}
             <input type="submit" class="btn btn-success" value="Add to Cart">
            </form>
            {% else %}
                <h4 class="muted all_out">Sorry I am all out for the day.<br><br>Come back <span class="orange">tomorrow</span>, I will be making a <span class="orange">fresh batch</span>.</h4>
            {% endif %}
        </div>
    </div>
    {% load imly_tags %}
    <div class="row-fluid">
        <br>
        <div class="span6 offset3">
            <hr>
        </div>
    </div>

    <div class="row-fluid">
        <div class="span2">
            <p><strong>Average Rating : </strong></p>
        </div>
        <div class="span10">
            {% if object.reviews.count %}
            <ul class="inline imly_star_rating">
                {% for i in object.reviews.average_rating|loop_int %}
                
                <li><img src="{{ STATIC_URL }}star-rating/individual_star.gif"></li>
                
                {% endfor %}
            </ul>
            {% else %}
                <p>Be the first to review</p>
            {% endif %}
        </div>
    </div>
    <br>
    <div class="row-fluid">
        <div class="span2">
            <p><strong>This item is : </strong></p>
        </div>
        <div class="span10">
            <ul class="inline tags_for_product">
                {% for tag in object.tags.all %}
                    <li>{{ tag }}</li>
                {% endfor %}
            </ul>
        </div>
    </div>
    <br>
    <div class="row-fluid">
        <div class="span2">
            <p><strong>Delivery Time :</strong></p>
        </div>
        <div class="span10">
            {% if object.lead_time == 1 %}
                <p>{{ object.lead_time }} {{ object.get_lead_time_unit_display }}</p>
            {% else %}
                <p>{{ object.lead_time }} {{ object.get_lead_time_unit_display }}s</p>
            {% endif %}
        </div>
    </div>
    <br>
    <div class="row-fluid">
        <div class="span2">
            <p><strong>Items Left :</strong></p>
        </div>
        <div class="span10">
            {{ object.items_in_stock }}
        </div>
    </div>

    
    {% if object.description %}
    <br>
        <div class="row-fluid">
            <div class="span2">
                <p><strong>Description :</strong></p>
            </div>
            <div class="span10">
                {{ object.description_html|safe }}
            </div>
        </div>
    {% endif %}

    
    
    <div class="row-fluid">
        <br>
        <div class="span6 offset3">
            <hr>
        </div>
    </div>
    
    <div class="row-fluid">
        <a name="reviews"></a><h4>Reviews:</h4>
        <br>
        {% if user.is_authenticated %}
        <form method="post" action="{% url "submit_product_review" %}">
            {% csrf_token %}
            <input type="hidden" name="store_slug" value="{{ object.store.slug }}" />
            <input type="hidden" name="product_slug" value="{{ object.slug }}" />

            {% for radio in review_form.score %}
                {{ radio.tag }}
            {% endfor %}
            <br>
            {% if review_form.score.errors %}
                <p class="review_form_errors">Please rate this product.</p>
            {% endif %}


            {% for field in review_form.content %}
                <p>{{ field }}</p>
            {% endfor %}
            {% if review_form.content.errors %}
                <p class="review_form_errors">Please review this product.</p>
            {% endif %}
            <input type="submit" class="btn" value="Submit Review">
        </form>
        {% else %}
            <h4 class="muted"><a href="#myModal" role="button" data-toggle="modal">Login</a> to review</h4>
        {% endif %}
    </div>
    
    <div class="row-fluid">
        
        <table class="table table-striped table-bordered">

        {% for review in object.reviews.all reversed %}
            <tr>
                <td>
                <span class="pull-right reviewer"><small>{{ review.user|capfirst }}</small></span>
                <ul class="inline imly_star_rating">
                {% for i in review.score|loop_int %}
                    <li><img src="{{ STATIC_URL }}star-rating/individual_star.gif"></li>
                {% endfor %}
                </ul>
                
            
                {{ review.content }}
                </td>
            </tr>
        {% endfor %}
        </table>

    </div>
        
{% endblock shop_product_content %}

