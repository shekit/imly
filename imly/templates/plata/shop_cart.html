{% extends "base_cart2.html" %}

{% load i18n plata_tags %}
{% load imly_tags %}
{% block title %}Imly | {% trans "Cart" %}{% endblock %}


{% block cart_content %}
    <div class="row-fluid">
        {% if empty %}
        <br><br><br><br>
        <h2 class="muted text-center">Your Cart is Empty :(</h2>
        <p class="text-center"><a href="{% url "imly_product_list" %}" class="btn btn-large btn-success">Start Shopping!</a></p>
        <br><br>
        {% else %}
        <h3>{% trans "Cart" %} ({{ plata.order.items.count }} items)</h3>
        <div class="alert alert-block">
            <b>Heads up!</b> Please ensure that the stores you order from either deliver to your area or provide pick-up facility before confirming your order.
        </div>
        <form method="post" action=".">{% csrf_token %}{{ orderitemformset.management_form }}
                
                {% if messages %}
                    <ul class="messages unstyled">
                        {% for message in messages %}
                            {% if "error" in message.tags %}
                                <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</li>
                            {% endif %}
                        {% endfor %}
                    </ul>
                {% endif %}
                
        {% form_errors orderitemformset %}
        
        {% for store in order.storeorder_set.all %}
        {% if store.store_items %}
        <table class="table table-bordered">

            <tr class="shop_cart_header">

                <th colspan="2">Your order from: <a class="shop_cart_store" href="{% url "imly_store_detail" store.store.slug %}">{{ store.store.name }}</a>
				{% if request.session.place_slug %}
                                    {% store_order_geo_info store request %}
                                {% endif %}
                <span class="pull-right">
					{% if store.store.delivers %}
                                            Delivers to you
                    {% endif %}    
                                        
                    {% if request.session.place_slug %}
                        <span class="icon-map-marker"></span> <small>{{ store.store.distance.km|floatformat:"1" }} {% pick_up_distance store.store %} kms</small>
                    {% endif %}
                </span>
                </th>
            </tr>
            
            <tr>
            <td>
                <table class="table table_top_border">
                    {% for orderitemform in orderitemformset.forms %}
                            {% ifequal orderitemform.instance.product.store.pk store.store.id %}
                            <tr>
                                <td class="less_padding">
                                    <table class="table table_border_right">
                                        <tr>
                                            <td class="less_padding_inner_td">
                                                <ul class="inline">
                                                    <li class="pull-left"><a href="{% url "imly_product_detail" orderitemform.instance.product.store.slug orderitemform.instance.product.slug %}"><img class="img-polaroid" src="{{ orderitemform.instance.product.image_thumbnail_mini.url }}" alt="{{ orderitemform.instance.product.name }}" width="100" height="80"></a></li>
                                                    <li>
                                                        <ul class="unstyled">
                                                            <li><span style="font-size:16px;">{{ orderitemform.instance.product.name }}</span></li>
                                                            
                                                            <li><small>Quantity:</small> <small class="muted"><i>({{ orderitemform.instance.product.items_in_stock }} left for today)</i></small><li>
                                                            <li>{{Â orderitemform.id }}{% form_item_plain orderitemform.quantity %}</li>
                                                            
                                                        </ul>
                                                    </li>
                                                </ul>
                                                <ul class="unstyled visible-phone cart_ul">
                                                    <li><b>{{ orderitemform.instance.currency }} {{ orderitemform.instance.unit_price|floatformat:0 }} <span class="muted">x</span> {{ orderitemform.instance.quantity }} = {{ orderitemform.instance.currency }} {{ orderitemform.instance.discounted_subtotal|floatformat:0 }}</b></li>
                                                    <li><small class="muted">Remove:</small> {% form_item_plain orderitemform.DELETE %}</li>
                                                </ul>
                                                
                                            
                                            </td>
                                            <td width="200"  class="less_padding_inner_td hidden-phone"><p class="text-center">

                                            {{ orderitemform.instance.currency }} {{ orderitemform.instance.unit_price|floatformat:0 }} <span class="muted">x</span> {{ orderitemform.instance.quantity }} = {{ orderitemform.instance.currency }} {{ orderitemform.instance.discounted_subtotal|floatformat:0 }}</p></td>
                                            <td class="less_padding_inner_td hidden-phone" width="70"><p class="text-center"><small class="muted">Remove:</small> {% form_item_plain orderitemform.DELETE %}</p></td>
                                        </tr>
                                    </table>
                                </td>
                            </tr>
                            {% endifequal %}
                        
                    {% endfor %}
                </table>
            </td>
            <td class="cart_delivery_section" >
                
                <ul class="unstyled text-center">

                    <li class="muted"><small>I want my order on:</small></li>
					{% store_order_options store %}
					<li><br></li>

                    <li><h3 class="muted">Rs. {{ store.store_total|floatformat:"0" }}</h3></li>
                    <li><small class="muted">Cash on Delivery</small></li>
                </ul>
                
            </td>
            </tr>
            
        </table>
        <br><br>

        {% endif %}

        {% endfor %}
            
            <ul class="inline text-right checkout_mobile">
                <li><a href="{% url "imly_product_list" %}" class="btn">Keep Shopping</a></li>
                <li><input type="submit" class="btn" name="save" value="{% trans "Update & Save" %}" /></li>
                <li><input type="submit" class="btn btn-success" name="checkout" value="{% trans "Checkout" %}" /></li>
            </ul>

        </form>
        {% endif %}
</div>
{% endblock cart_content %}


{% block shop_info %}


{% endblock shop_info %}   
